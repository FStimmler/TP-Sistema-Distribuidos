<form id="form1">
  <label for="fecha">Fecha</label>
  <input type="date" id="fecha" min="2018-01-01">

  <p><label for="email">Email</label>
    <input type="email" name="email" id="email" />
  </p>

  <p><label for="branchId">branchId</label>
    <input type="number" name="branchId_s" id="branchId" />
  </p>

  <div><button type="submit">Buscar turnos</button></div>
</form>

<form id="form2">
  <label for="hora">Hora</label>
  <select id="hora">
  </select>
  <div><button type="submit">Enviar</button></div>
</form>


<script>

  let optionList = document.getElementById('hora').options;
  var formdata;

  function getTurnos(params) {

    fetch("http://localhost:5000/api/turnos" + params)
      .then(function (response) {
        return response.json();
      })
      .then(function (jsonResponse) {
        const mapa = (JSON.parse(JSON.stringify(jsonResponse))).map(function (element) {
          return element;
        });


        document.getElementById("hora").innerHTML = "";
        mapa.forEach((element) => {
          let hora = element.fecha.split("T")[1].split(':');
         
          optionList.add(
            new Option(hora[0] + ":" + hora[1], hora[0] + ":" + hora[1], false)
          )
        })

      });
  }

  function buscarTurnos(event) {
    event.preventDefault();

    arrayfecha = document.getElementById('fecha').value.split("-");



    fechautc = new Date(Date.UTC(arrayfecha[0], arrayfecha[1] - 1, arrayfecha[2]));
    formdata = event.target;
    const myFormData = new FormData(event.target);
    const formDataObj = {};
    myFormData.forEach((value, key) => (formDataObj[key] = value));
    formDataObj['fecha'] = fechautc;
    querry = "?fecha=" + formDataObj['fecha'].toISOString()
      + '&branchId=' + formDataObj['branchId_s']
      + '&userId=null';

    getTurnos(querry);
  }

  function handleSubmit(event) {
    event.preventDefault();

    arrayfecha = document.getElementById('fecha').value.split("-");

    arrayhora = document.getElementById('hora').value.split(":");

    fechautc = new Date(Date.UTC(arrayfecha[0], arrayfecha[1] - 1, arrayfecha[2], arrayhora[0], arrayhora[1]));
    const myFormData2 = new FormData(formdata);
    const myFormData = new FormData(event.target);
    const formDataObj = {};
    myFormData2.forEach((value, key) => (formDataObj[key] = value));
    myFormData.forEach((value, key) => (formDataObj[key] = value));
    formDataObj['fecha'] = fechautc;
    enviar(JSON.stringify(formDataObj));
  }

  function enviar(value) {
    var response
    fetch('http://localhost:5000/api/turnos', {
      method: 'POST',
      body: value,
    })
      .then(async res => { if (res.status != 201) window.alert(await res.text()) })
  }

  const form1 = document.querySelector('#form1');
  form1.addEventListener('submit', buscarTurnos);
  const form2 = document.querySelector('#form2');
  form2.addEventListener('submit', handleSubmit);

</script>